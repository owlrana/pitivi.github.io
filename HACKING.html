<!DOCTYPE html>
<html lang="en">
<head>

<base href=".">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>Hacking on Pitivi</title>

<link rel="stylesheet" href="assets/css/custom_bootstrap.css" type="text/css">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css" type="text/css">
<link rel="stylesheet" href="assets/css/frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">

<link rel="stylesheet" href="assets/css/prism.css" type="text/css">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/scrollspy.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/isotope.pkgd.min.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/jquery.touchSwipe.min.js"></script>
<script src="assets/js/anchor.min.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>

<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/trie.js"></script>

<link rel="shortcut icon" href="assets/images/favicon.png">

</head>

<body class="no-script
" data-spy="scroll" data-target="#toc" data-offset="70">

<script>
$('body').removeClass('no-script');
</script>

<nav class="navbar navbar-fixed-top navbar-default" id="topnav">
	<div class="container-fluid">
		<div class="navbar-right">
			<a id="toc-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<form action="" class="navbar-form pull-right" id="navbar-search-form">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control input-sm" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
				       <span class="glyphicon glyphicon-search form-control-feedback" id="search-mgn-glass"></span>
                               </div>
                        </form>
		</div>
		<div class="navbar-header">
			<a id="sidenav-toggle">
				<span class="glyphicon glyphicon-menu-right"></span>
				<span class="glyphicon glyphicon-menu-left"></span>
			</a>
			<a id="home-link" href="index.html" class="hotdoc-navbar-brand">
				<img src="assets/images/pitivi.svg" alt="Home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
							</ul>
			<div class="hidden-xs hidden-sm navbar-text navbar-center">
				<p><b>The Pitivi Developer Documentation</b></p>
			</div>
		</div>
	</div>
</nav>

<main>
<div data-extension="core" data-hotdoc-in-toplevel="True" data-hotdoc-project="Pitivi-1.0" data-hotdoc-ref="HACKING.html" class="page_container" id="page-wrapper">
<script src="assets/js/utils.js"></script>

<div class="panel panel-collapse oc-collapsed" id="sidenav" data-hotdoc-role="navigation">
	<script src="assets/js/navigation.js"></script>
	<script src="assets/js/sitemap.js"></script>
</div>

<div id="body">
	<div id="main">
				    <div id="page-description" data-hotdoc-source="HACKING.md" data-hotdoc-role="main">
        <h1 id="hacking-on-pitivi">Hacking on Pitivi</h1>
<h2 id="the-pitivi-development-environment">The Pitivi development environment</h2>
<p>The official way of getting your environment up and running is by using
<a href="http://flatpak.org/">flatpak</a>. For this you need to
<a href="http://flatpak.org/getting.html">install flatpak</a> on your system,
along with flatpak-builder, which might be provided by an
additional package on some distributions (please tell us if it is the case
for yours so we can make a list here).</p>
<h3 id="setting-up-the-development-environment">Setting up the development environment</h3>
<p>Create a development environment folder and get the <a href="https://git.gnome.org/browse/pitivi/tree/">Pitivi source code</a> into it:</p>
<pre><code>$ mkdir pitivi-dev
$ cd pitivi-dev
$ git clone https://git.gnome.org/browse/pitivi
</code></pre>
<p>When you hack on Pitivi, enter the development environment to get:</p>
<ul>
<li>a <a href="http://docs.flatpak.org/en/latest/working-with-the-sandbox.html">Flatpak sandbox</a>
for the dependencies, in <code>pitivi-dev/pitivi-prefix</code>
</li>
<li>a <a href="http://docs.python-guide.org/en/latest/dev/virtualenvs/">Python virtual environment</a>
with development tools, such as
<a href="https://phabricator.freedesktop.org/diffusion/GITPHAB/#description">git-phab</a> and
<a href="http://pre-commit.com">pre-commit</a>,
in <code>pitivi-dev/pitivi/build/flatpak/pyvenv</code>
</li>
<li>the <a href="http://mesonbuild.com/Quick-guide.html">Meson build directory</a>,
in <code>pitivi-dev/pitivi/mesonbuild</code>
</li>
<li>some aliases for the build tools, such as <code>ninja</code>, so they are executed in the sandbox.</li>
</ul>
<pre><code>$ cd pitivi-dev/pitivi &amp;&amp; source bin/pitivi-env
-&gt; Setting up the prefix for the sandbox...
Using Pitivi prefix in /.../pitivi-dev/pitivi-prefix
[prefix being built, if not already...]
Running in sandbox: echo Prefix ready
Prefix ready
</code></pre>
<p>Note: This can take a while when creating the sandbox from scratch.</p>
<p>Run the <a href="Testing.html">unittests</a>:</p>
<pre><code>(ptv-flatpak) $ ninja -C mesonbuild/ test
Running in sandbox: ninja -C mesonbuild/ test
</code></pre>
<p>Hack away, and check the effect of you changes by simply running:</p>
<pre><code>(ptv-flatpak) $ pitivi
</code></pre>
<h3 id="development-workflow">Development Workflow</h3>
<p>We use <a href="https://phabricator.freedesktop.org/tag/pitivi/">Phabricator tasks</a> to track all bugs and feature requests; feel free to open a task if you have found a bug or
wish to see a feature implemented if it doesn't exist already.
You can even subscribe to tasks on Phabricator to keep yourself updated with their progress.
If you're a newcomer wanting to contribute, you can start with tasks tagged <a href="https://phabricator.freedesktop.org/tag/pitivi_tasks_for_newcomers/">Pitivi tasks for newcomers</a> to get involved.</p>
<p>To fix a task, it's best to get in touch with us on our IRC channel <code>#pitivi</code> on Freenode, to see if it's still meaningful, then if all is well:</p>
<ol>
<li>
<p>Assign the task to yourself in Phabricator.</p>
</li>
<li>
<p>Create a new branch with a relevant name. Make sure to set its <a href="https://git-scm.com/book/en/v2/Git-Branching-Remote-Branches/">remote-tracking branch</a>, as it determines the default commit range to attach.
For example, if you're going to work on task <a href="https://phabricator.freedesktop.org/T7674/">T7674</a>, the branch could be called T7674-import-img or
T7674-fix-import, i.e. <code>git checkout -b T7674-import-img origin/master</code>.</p>
</li>
<li>
<p>Once you have made your changes, you need to create a commit. Follow the <a href="https://wiki.gnome.org/Newcomers/CodeContributionWorkflow#Commit_guidelines">GNOME guidelines</a>
for creating commits.</p>
<p>Be aware that when you create a commit, <code>pre-commit</code> is executed to perform checks on the changes and in some cases it does
some automatic fixes. When this happens, make sure those are included in the commit you want to create.</p>
</li>
<li>
<p>Now you're all set to push your first diff to
<a href="https://phabricator.freedesktop.org/tag/pitivi">Phabricator</a> for review!</p>
<pre><code>(ptv-flatpak) $ git-phab attach --task TXXXX
</code></pre>
</li>
</ol>
<p>Optionally, you can set git-phab to automatically push your WIP branches to a personal remote repository:</p>
<ol>
<li>
<p>Add your cloned remote Pitivi repository as a remote to your local repository:</p>
<pre><code>$ git remote add github https://github.com/NICK/pitivi.git
$ git remote set-url github https://github.com/NICK/pitivi.git
$ git remote set-url --push github git@github.com:NICK/pitivi.git
$ git remote show github | grep URL
  Fetch URL: https://github.com/NICK/pitivi.git
  Push  URL: git@github.com:NICK/pitivi.git
</code></pre>
</li>
<li>
<p>Set git-phab remote to your cloned remote Pitivi repository:</p>
<pre><code>$ git config phab.remote github
</code></pre>
</li>
</ol>
<h3 id="building-the-c-parts">Building the C parts</h3>
<p>Select parts of Pitivi are written in C and need to be built when changed,
such as the audio envelope renderer for the audio clips. Build them with:</p>
<pre><code>(ptv-flatpak) $ ninja -C mesonbuild/
Running in sandbox: ninja -C mesonbuild/
</code></pre>
<h3 id="updating-the-development-environment">Updating the development environment</h3>
<p>To update the dependencies installed in the sandbox, run:</p>
<pre><code>(ptv-flatpak) $ ptvenv --update
</code></pre>
<p>That will actually recreate the prefix, update all dependencies from their
git repos and tarballs as defined in the <a href="https://git.gnome.org/browse/pitivi/tree/build/flatpak/pitivi.template.json">flatpak manifest</a> (located
at build/flatpak/pitivi.template.json)</p>
<h3 id="working-on-pitivi-dependencies-meson">Working on Pitivi dependencies (Meson)</h3>
<p>If you have to work on say, <a href="https://gstreamer.freedesktop.org/modules/gst-editing-services.html">GStreamer Editing Services</a>
which is built using the Meson build system, first clone it into your
<code>pitivi-dev</code> folder:</p>
<pre><code>(ptv-flatpak) $ git clone git://anongit.freedesktop.org/gstreamer/gst-editing-services
</code></pre>
<p>Prepare its build directory. Once it has been set up, you won't have to
run <code>meson</code> again for this build directory.</p>
<pre><code>(ptv-flatpak) $ setup
Using Pitivi prefix in /.../pitivi-dev/pitivi-prefix
Running in sandbox: meson mesonbuild/ --prefix=/app --libdir=lib -Ddisable_gtkdoc=true -Ddisable_doc=true
</code></pre>
<p>Build and install it in the sandbox:</p>
<pre><code>(ptv-flatpak) $ ninja -C mesonbuild/ install
Using Pitivi prefix in /.../pitivi-dev/pitivi-prefix
Running in sandbox: ninja -C mesonbuild/ install
</code></pre>
<p>In the <code>(ptv-flatpak)</code> development environment <code>meson</code> and <code>ninja</code> are
aliases which run meson and ninja in the flatpak sandbox.</p>
<p>NOTE: When updating the environment with <code>ptvenv --update</code>,
it will use your local dependencies repositories it finds in the
<code>pitivi-dev</code> folder, instead of the default remote repositories.
This means you have to update them yourself.
Also beware that it will not take into account not committed
changes.</p>
<h3 id="working-on-pitivi-dependencies-autotools-make-etc">Working on Pitivi dependencies (Autotools, Make, etc)</h3>
<p>If the project you are working on is built with other tools, make sure
they are run in the sandbox by using <code>ptvenv</code>. For example:</p>
<pre><code>(ptv-flatpak) $ cd pitivi-dev/frei0r-plugins-1.4
(ptv-flatpak) $ ptvenv ./autogen.sh
Running in sandbox: ./autogen.sh
(ptv-flatpak) $ ptvenv ./configure
Running in sandbox: ./configure
(ptv-flatpak) $ ptvenv make
Running in sandbox: make
</code></pre>
<h2 id="coding-style-guide">Coding Style Guide</h2>
<p>We rely on the <a href="https://www.python.org/dev/peps/pep-0008/">Python Style Guide PEP-8</a></p>
<p>The only exception to it is regarding the "80 columns" rule.
Since Python is a very concise/compact language, we can afford to be
a little bit more flexible on the line length than languages such as C.</p>
<p>When deciding whether or not you should split your line when it exceeds
79 characters, ask yourself: "Does it truly improve legibility?"</p>
<p>What this translates to is:</p>
<ul>
<li>
<p>Avoid having very long lines.</p>
</li>
<li>
<p>When the contents only slightly exceeds the 80 chars limit,
consider keeping it on one line. Otherwise it just hurts legibility and
gives a weird "shape" to the code.</p>
</li>
</ul>
<h3 id="names">Names</h3>
<p>The function names, method names and other class attributes should be
small_caps_with_underscore. For example:</p>
<pre><code class="language-python">def some_function():
    return ""

class MyClass:

    def a_really_important_method(self):
        self.do_something()

    @property
    def water_level(self):
        """The level of the water in meters."""
        return self.__water_level
</code></pre>
<p>To illustrate how private a method or other class field is, prepend
one or two underscores:</p>
<pre><code class="language-python">  class MyClass:

     def public_method(self):
         ...

     def _protected_method(self):
         ...

     def __private_method(self):
         ...
</code></pre>
<p>Unused arguments in methods should be prefixed with <code>unused_</code>.
The most common place where this would happen is in callbacks from
gobject signals. For example, below we don't use the second argument,
but we do use <code>pad</code>.</p>
<pre><code class="language-python">     def __pad_added_cb(self, unused_element, pad):
        self.do_something_with(pad)
</code></pre>
<p>The name of a callback method should:</p>
<ul>
<li>be prepended with two underscores since it's private</li>
<li>be appended with <code>cb</code>
</li>
</ul>
<pre><code class="language-python">  class MyClass:

     def some_method(self):
         self.someobject.connect('event', self.__some_object_event_cb)

     def __some_object_event_cb(self, object, arg):
         print "our callback was called"
</code></pre>
<h3 id="imports-order">Imports order</h3>
<p>You can guess the order of the imported modules by looking at some py files.
The pre-commit hook has authority in this case as it will reorder the imports
if the order is not good.</p>
<h2 id="profiling-pitivi">Profiling Pitivi</h2>
<p>To profile a pitivi run, simply set the PITIVI_PROFILING environment variable to 1, like so:</p>
<pre><code>$ PITIVI_PROFILING=1 pitivi
</code></pre>
<p>A file named <code>pitivi-runstats</code> will be created in the current directory, a handy tool to examine it is <code>gprof2dot.py</code>, install it with:</p>
<pre><code>$ pip install gprof2dot
</code></pre>
<p>Then run:</p>
<pre><code>$ gprof2dot -f pstats pitivi-runstats | dot -Tsvg -o profile.svg
</code></pre>
<p>You can then inspect the call tree profile with your preferred image viewer:</p>
<pre><code>$ xdg-open profile.svg
</code></pre>

    </div>
        




		<div id="subpages">
	<p><b>Subpages:</b></p>
			<p>
		<a href="Git.html">Git</a>
		–
					<i><em>No description available</em></i>
				</p>
			<p>
		<a href="Git_repositories.html">Git repositories</a>
		–
					<i><em>No description available</em></i>
				</p>
			<p>
		<a href="Command_line_tools.html">Command line tools</a>
		–
					<i><em>No description available</em></i>
				</p>
			<p>
		<a href="Pitivi_Love.html">Pitivi Love</a>
		–
					<i><em>No description available</em></i>
				</p>
	</div>
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
	<hr>
	<div id="footer">
		    

	</div>
</div>

<div id="toc-column">
	
		<div class="edit-button">
		<a href="https://github.com/pitivi/pitivi/edit/master/docs/HACKING.md" data-hotdoc-role="edit-button">Edit on github</a>

	</div>
		<div id="toc-wrapper">
		<nav id="toc"></nav>
	</div>
</div>
</div>
</main>

</body>

<script src="assets/js/navbar_offset_scroller.js"></script>
</html>
