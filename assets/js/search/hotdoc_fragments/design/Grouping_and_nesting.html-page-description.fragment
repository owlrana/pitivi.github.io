fragment_downloaded_cb({"url": "design/Grouping_and_nesting.html#page-description", "fragment": "<div id=\"page-description\" data-hotdoc-source=\"Grouping_and_nesting.md\">\n<h1 id=\"grouping-and-nesting\">Grouping and nesting</h1>\n<p>This page is intended to discuss the following concepts:</p>\n<ul>\n<li>Infinite clip grouping (vs the old \u201cgrouping vs linking\u201d approach)</li>\n<li>\u201cCompound\u201d clips (a more visual form of grouping)</li>\n<li>Nested timelines/projects</li>\n</ul>\n<p>For the following objects:</p>\n<ul>\n<li>Management of clips on the timeline canvas</li>\n<li>Project management in general</li>\n</ul>\n<h1 id=\"proposal-recursive-pitivi\">Proposal: Recursive Pitivi</h1>\n<p>When managing video projects of more than trivial complexity, it is\noften crucial to be able to treat a group of objects on the timeline as\na unified object, from a user interface perspective. We are interested\nin finding methods of grouping that provide maximum user productivity at\nminimum development cost.</p>\n<h2 id=\"recursion-via-gstreamer\">Recursion via GStreamer</h2>\n<p>At one extreme, the minimum development cost approach is one that\nrequires exactly no code within Pitivi (or GES). Instead, we may create\na new gstreamer decoder element (e.g. pitividec) that takes as its input\nthe contents of a Pitivi project file. This decoder would reuse the GES\ncore to expose an interface equivalent to decodebin.</p>\n<p>Once such an element is appropriately registered, decodebin,\nuridecodebin, and playbin will be able to play Pitivi project files as\nif they were video clips. This means that Pitivi project files would,\nwith no additional code, become playable in gstreamer-based players such\nas Totem (subject to CPU limitations, of course). Naturally, it also\nmeans that they are importable as clips into Pitivi itself, for use in\nhigher-level timelines.</p>\n<p>In effect, this approach is equivalent to rendering out the project to\nan intermediate clip that is then imported into another project, except\nthat it avoids the cost in disk space and compression loss. A\nsufficiently advanced implementation might also negotiate output\nparameters such as resolution to avoid unnecessary scaling.</p>\n<h3 id=\"limitations\">Limitations</h3>\n<p>The disadvantage of this approach is that it does not provide the full\nflexibility of traditional grouping mechanisms. There is no way to\n\u201cungroup\u201d (i.e. to flatten a part of the group hierarchy). There is no\nway to edit a group within the context of the larger project. This\nfunctionality may be worth implementing but it is not sufficient on its\nown to satisfy all our group management needs.</p>\n<h2 id=\"internal-recursion\">Internal Recursion</h2>\n<p>To provide more advanced functionality, we will require recursion that\nis not opaque to the Pitivi user interface. In Pitivi, source clips are\nimmutable, and this invariant seems worth preserving for the sake of\npredictable behavior. Therefore, if groups are to be editable (and\ndistinct from ordinary clips), they should not be implemented via the\nstandard clip mechanism as described above.</p>\n<p>To allow the user interface to behave differently for groups than for\nindividual clips, while still preserving a simple recursive structure,\none solution is to have entire Pitivi sub-projects defined within a\nsingle project file, and inserted into the timeline as a\ntimeline-object. Then the \u201cgroup\u201d action generates a subproject\nequivalent to the selected items, deletes those items from the timeline,\nand adds the subproject-object to the timeline in their place. \u201cUngroup\u201d\ndoes the reverse.</p>\n<h3 id=\"possible-implementation-in-ges\">Possible implementation in GES</h3>\n<p>We should have a GESTimelineTimelineObject class (better name to be\nfound?), This class is a subclass of GESTimelineSource thus it is a\nwrapper around GnlSource (which is a GstBin itself), this bin would\ncontain a GESTimeline. Then the TrackObject of this TimelineObject\ncontain GESTrack themselves. We should have 3 ways of creating a\nGESTimelineTimelineObject:</p>\n<p><code>\u00a0\u00a0\u00a0ges_timeline_timeline_object_new()</code><br>\n<code>\u00a0\u00a0\u00a0ges_timeline_timeline_object_new_from_objects\u00a0(GList\u00a0*timeline_object)\u00a0/*So\u00a0we\u00a0can\u00a0group\u00a0them\u00a0easyly\u00a0*/</code><br>\n<code>\u00a0\u00a0\u00a0ges_timeline_timeline_object_new_from_project\u00a0(const\u00a0gchar\u00a0*project_file_uri)</code></p>\n<p>The timeline contained in a GESTimelineTimelineObject can obviously also\ncontain themselves a GESTimelineTimelineObject so we can infinitely\nrecurse.</p>\n<h4 id=\"new-classes\">New Classes</h4>\n<p><code>\u00a0\u00a0\u00a0GESTimelineSource</code><br>\n<code>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0+----\u00a0GESTimelineTimelineObject</code></p>\n<p><code>\u00a0\u00a0\u00a0GESTrackSource</code><br>\n<code>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0+----\u00a0GESTrackTrackObject</code></p>\n<h3 id=\"ui-niceties\">UI Niceties</h3>\n<p>Because the UI can easily determine that a timeline-object is in fact a\ngroup, that object may be treated specially for UI purposes. In addition\nto exposing an Ungroup action, the object may also present an \u201cEdit\nGroup\u201d option. This would open a new timeline (perhaps a new Pitivi\nwindow) showing the contents of the group, allowing the user to make\nalterations without the clutter of the entire super-project.</p>\n<h3 id=\"open-questions\">Open Questions</h3>\n<p>Should it be possible to cut, stretch, or apply effects to a group?\nDoing so potentially makes it impossible to \u201cungroup\u201d (if, for example,\neffects are applied on top of transitions), and certainly makes\nungrouping require a certain amount of tricky logic to propagate global\nactions (like chopping out a chunk in time) down to the source clips. (I\nthink that it should be possible to apply such effects and arbitrary\noperations to a group, and that Ungroup should simply be disabled until\nall modifications to the group are removed.)</p>\n<p>Should groups be displayed in the superproject with \u201choles\u201d in time\nwhere there is an empty time in the subproject timeline, or should they\nsimply be continuous? Should there be a mode where even more of the\ninternal structure is visible? (I think that, for a first\nimplementation, leaving them as continuous in the superproject UI is\nentirely sufficient and dramatically simpler to implement than the\nalternatives.)</p>\n<p>Is the duration of a group fixed or variable? If it is fixed, then we\nwill need some UI to indicate a timeline of fixed duration (in the\nsubproject editor). If it is variable, then what happens when the user\nuses the subproject editor to make the contents of the group longer?\nShould it expand in the super-project, or should excess time be ignored.\n(I think excess time should be ignored, with duration controlled\nexclusively from the super-project. Ideally, it should be possible to\nmodify duration (and start-point) non-destructively from the\nsuper-project, and the subproject editor UI should indicate which\nportions of its timeline are actually in use in the super-project.)</p>\n<p>Should it be possible to copy a group by reference or only by value?\ni.e. can there exist multiple objects in a timeline that refer to the\nsame subproject? (I think copy-by-reference is too valuable to give up,\nbut careful UI design will be required to avoid creating massive\nconfusion. A unique name for each subproject, displayed in every\nsuperproject timeline-object that references it, might help.)</p>\n<h3 id=\"limitations1\">Limitations</h3>\n<p>If a group is representable as a single object, then it cannot span\nnon-contiguous layers in the timeline. Specifically, in current video\neditors it is possible to create a group that contains (partially\ntransparent) content at Layer 1 and Layer 3 but none at Layer 2, so that\na timeline object that is not part of the group may be blended between\ntwo objects that are part of the group. (In my view, this behavior is\nnot really desirable, and the simplicity of \u201ca group is a timeline\nobject\u201d is worth the loss of functionality.)</p>\n<h1 id=\"infinite-clip-grouping\">Infinite clip grouping</h1>\n<p>The notion of grouping/linking as it was in <a href=\"../releases/0.15.html\">0.15</a> and\nearlier is nonsensical from a user's point of view. More details in <a href=\"https://bugzilla.gnome.org/show_bug.cgi?id=583266\">bug\n583266</a>.</p>\n<p>As a user, I want infinite grouping (like in Inkscape), not have to make\na theoretical distinction between linking and grouping.</p>\n\n</div>\n\n\n        "});